pico-8 cartridge // http://www.pico-8.com
version 27
__lua__
--main
function _init()
	p=make_player(14,14)
	e=make_enemy(56,56)
end

function _update()
	--left
	if btn(0) then
		for nx=p.x,p.x-p.speed,-1 do
			if (nx<p.r) break
			if not circle_hit(nx,p.y,p.r,
																		e.x,e.y,e.w,e.h) then
				p.x=nx
			end
		end
	end
	--right
	if btn(1) then
		for nx=p.x,p.x+p.speed do
			if (nx>128-p.r) break
			if not circle_hit(nx,p.y,p.r,
																		e.x,e.y,e.w,e.h) then
				p.x=nx
			end
		end
	end
	--up
	if btn(2) then
		for ny=p.y,p.y-p.speed,-1 do
			if (ny<p.r) break
			if not circle_hit(p.x,ny,p.r,
																		e.x,e.y,e.w,e.h) then
				p.y=ny
			end
		end
	end
 --down
	if btn(3) then
		for ny=p.y,p.y+p.speed do
			if (ny>128-p.r) break
			if not circle_hit(p.x,ny,p.r,
																		e.x,e.y,e.w,e.h) then
				p.y=ny
			end
		end
	end

end

function _draw()
	cls()
	rect(0,0,127,127,7)
	spr(1,p.x-p.r,p.y-p.r)
	spr(2,e.x,e.y,e.w/8,e.h/8)
	--print(ac,2,2,8)	
	--print("x="..p.x..",y="..p.y,2,120,9)
end
-->8
--actors
function make_player(x,y)
	local player={
		x=x,
		y=y,
		r=4,
		speed=3,
	}
	return player
end

function make_enemy(x,y)
	local enemy={
		x=56,
		y=56,
		w=16,
		h=16,
	}
	return enemy
end

function box_hit(
	x0,y0,
	w0,h0,
	x1,y1,
	w1,h1)
	local xs,ys=(w0+w1)/2,(h0+h1)/2
	local xd=abs(x0-x1+(w0-w1)/2)
 local yd=abs(y0-y1+(h0-h1)/2)
	return xd<xs and yd<ys
end

function circle_hit(
	xc,yc,
	rc,
	x1,y1,
	w1,h1)
	
	ac=atan2(xc-(x1+w1/2),yc-(y1+h1/2))

 local xs=abs(rc*cos(ac))+w1/2
 local ys=abs(rc*sin(ac))+h1/2
 
 local xd=abs(xc-(x1+w1/2))
 local yd=abs(yc-(y1+h1/2))

	return xd<xs and yd<ys
end
__gfx__
00000000009999006656565656565656000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000099999906655555555555565000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700a91991995565555555555656000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000a99999996556666666666555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000a91111995556666666666556000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700a99119996556666666666555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000a9999905556666666666556000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000aaaa006556666666666555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000005556666666666556000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000006556666666666555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000005556666666666556000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000006556666666666555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000005556666666666556000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000006565555555555655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000005655555555555566000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000006565656565656566000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

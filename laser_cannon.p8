pico-8 cartridge // http://www.pico-8.com
version 27
__lua__
--lasercannon
--by reynaldo
explosions={}
enemies={}
particles={}
stars={}
shots={}
ship={
	x=7*8,
	speed=0,
}

function lerp(start,finish,factor)
	return mid(start,start*(1-factor)+finish*factor,finish)
end

function rndb(lo,hi)
	return flr(rnd(hi-lo+1)+lo)
end

function make_explosion(x,y)
	for i=2,rndb(4,8) do
		local e={
			x=rndb(x-4,x+4),
			y=rndb(y-4,y+4),
			r=rndb(4,8),
			c=7,
			age=rndb(8,15),
		}
		add(explosions,e)
	end
end

function check_hit(
	x0,y0,
	x1,y1,
	w1,h1)
	return x0>=x1 and x0<=x1+w1
	 and y0>y1 and y0<=y1+h1
end

function _init()
	for i=1,100 do
		local star={
			x=rndb(2, 126),
			y=rndb(2,12*8),
			c=rnd({5,6,7})
		}
		add(stars,star)
	end
end

function _update()
	--move enemies
	for e in all(enemies) do
		e.x+=e.spd
		if (e.x>128) del(enemies,e)
	end
	
	--move shots
	for s in all(shots) do		
		s.ly=s.y
		local hit=false
		
		for ny=s.y,s.y-s.spd,-1 do
			for e in all(enemies) do
				hit=check_hit(s.x,ny,e.x,8,8,8)
				if hit then	
					del(enemies,e)
					sfx(2)
					add(explosions,make_explosion(s.x,ny))
				end
			end
			if hit then
				del(shots,s)
		 else
				s.y=ny
			end
		end
		
		if not hit then
			if (s.ly<0) del(shots,s)
		end
	end
	
	--spawn
	if #enemies==0 and rndb(1,10)>9 then
		local enemy={
			x=0,
			spd=rndb(2,4),
		}
		add(enemies,enemy)
	end

	--move ship
	local dx=0
	if (btn(⬅️)) dx=-3
	if (btn(➡️)) dx= 3
	ship.speed=lerp(ship.speed,dx,0.08)
	if (abs(ship.speed)<0.1 and dx==0) ship.speed=0
	ship.x=mid(0,ship.x+ship.speed,121)

	--shoot gun
	if btnp(❎) and #shots==0 then
		if abs(ship.speed)<1 then
			local shot={
				x=ship.x+3,
				y=13*8,
				ly=13*8,
				spd=33,
			}
			add(shots,shot)
			sfx(0)
		else
			sfx(1)
		end
	end

	--stars
	for s in all(stars) do
		s.c+=1
		if (s.c>7) s.c=5
	end
	
	--explosions
	for e in all(explosions) do
		e.age-=1
		if e.age>8 then
			e.c=7
		elseif e.age>6 then
			e.c=10
		else
			e.c=9
		end 
		if (e.age<0) del(explosions,e)
	end
end

function _draw()
	cls()
	map()
	for s in all(stars) do
		pset(s.x,s.y,s.c)
	end
	for e in all(enemies) do
		spr(3,e.x,8)
	end		
	spr(1,ship.x,13*8)	
	for s in all(shots) do
		line(s.x,s.ly,s.x,s.y,8)
	end
	for e in all(explosions) do
		circfill(e.x,e.y,e.r,e.c)
	end	
end
__gfx__
00000000000500000000000090000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000600000000000009099090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000600000000000000999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000030603000000000009899890000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000036663000000000009900990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700063636000000000000099000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000003330000000000090900909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000535353500000000009000090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000066666666dddd555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000565555655dddd55d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000005555555555ddddd500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000005d5555d5ddd5dd5500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000d5d55dddd555ddd500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ddddd5d55555d55d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000005d555ddd5ddddd5500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000d5d5d5d5dd555ddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121212121212121212121212121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000200001a6200a17029250222501b000210002a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0004000039750396300f4501f75000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000a000000000296501b660136700667015650386502e6501a6300e62006620000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

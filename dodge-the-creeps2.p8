pico-8 cartridge // http://www.pico-8.com
version 27
__lua__
--dodge the picr88ps
--by reynaldo
left,right,up,down,fire1,fire2=0,1,2,3,4,5
black,dark_blue,dark_purple,dark_green,brown,dark_gray,light_gray,white,red,orange,yellow,green,blue,indigo,pink,peach=0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15

function _init()
	player=make_player(64-2*8,64-2*8)
end

function _update()
	player:update()
end

function _draw()
	cls(3)
	player:draw()
end

-->8
--player
shadows={}

function make_player(x,y)
	local player={
		x=x,y=y,
		si=1,
		w=2,
		h=2,
		speed=5,
		flipx=false,
		flipy=false,
		timer=0,
		hbx=x+6,
		hby=y+5,
		hbr=5,
	}
	--update
	player.update=function(p)
			--shadows
			for s in all(shadows) do
				s.life-=1
				if s.life>3 then
					s.scale=0.8
				elseif s.life>1 then
					s.scale=0.75
				elseif s.life>0 then
					s.scale=0.6
				else
					del(shadows,s)
				end
			end
	
			local dx,dy=0,0
			if (btn(right)) dx= 1
			if (btn(left)) dx=-1
			if (btn(up)) dy=-1 
			if (btn(down)) dy= 1 
			
			if dx~=0 or dy~=0 then
				--flip sprite
			 	p.flipx=dx<0
			 	p.flipy=dy>0
				
				--animation timer
				p.timer+=1
				if (p.timer%3==0) p.si=p.si==1 and 3 or 1
				add_shadow(p)				
			end
	
			if dx~=0 and dy~=0 then
				dx*=0.7
				dy*=0.7
			end	
			
			check_hits(p)
			
			p.x=mid(0,p.x+dx*p.speed,128-p.w*8+2)
			p.y=mid(0,p.y+dy*p.speed,128-p.h*8)

			--hitbox location
			p.hbx=p.x+(p.flipx and 7 or 6)
			p.hby=p.y+(p.flipy and 10 or 5)
	end
	
	--draw
	player.draw=function(p)
			set_player_pal()
			for s in all(shadows) do
    		local fw,fh=s.w*8,s.h*8
				local sw,sh=fw*s.scale,fh*s.scale
				sspr(s.si*8,0,fw,fh,s.x+(fw-sw)/2,s.y+(fh-sh)/2,sw,sh,s.flipx,s.flipy)
			end			
			outline_spr(p.si,p.x-1,p.y,p.w,p.h,p.flipx,p.flipy)
			--draw hitbox boundaries
			circ(p.hbx,p.hby,p.hbr,yellow)
	end
	
	return player
end

function add_shadow(player)
	local shadow={
		x=player.x,y=player.y,
		si=player.si,
		w=player.w,
		h=player.h,
		flipx=player.flipx,
		flipy=player.flipy,
		scale=1,
		life=4,	
	}
	add(shadows,shadow)
end

function check_hits()
		
end
-->8
--enemies
enemies={}

function make_enemy(x,y)
	local enemy={
		x=x,y=y,
		sx=2,
		sy=0,
		hbx=x+6,
		hby=y+5,
		hbr=5,
		timer=0,		
	}
	enemy.update=function(e)
		for e in all(enemies) do
			if (e.x>128 or e.y>128) del(enemies, e)
			if ()
		end
	end
	enemy.draw=function(e)
		
	end
	return enemy
end
-->8
--utils

--default pal settings
function set_player_pal()
	pal()
	palt(0,false)
	palt(11,true)
end

--draw sprites outlined in black
function outline_spr(n,x,y,w,h,flip_x,flip_y)
	w=w or 1
	h=h or 1
	flip_x=flip_x or false
	flip_y=flip_y or false
	for i=1,15 do
		pal(i,0)
	end
	for xoffset=-1,1 do
 	for yoffset=-1,1 do
  	spr(n,x+xoffset,y+yoffset,w,h,flip_x,flip_y)
  end
	end
	set_player_pal()
 spr(n,x,y,w,h,flip_x,flip_y)
end

__gfx__
00000000bbbbbb555bbbbbbbbbbbbb555bbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbb5ddddd5bbbbbbbbb5ddddd5bbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700bbbddd777dddbbbbbbbddd777dddbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000bb5dd77777dd5bbbbb5dd77777dd5bbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000b5dd7777007dd5bbb5dd7777007dd5bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700b5dd7777007dd5bbb5dd7777007dd5bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000b5dd7777777dd5bbb5dd7777777dd5bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bb5dd77777dd5bbbbb5dd77777dd5bbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbddd777dddbbbbbbbddd777dddbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbb5ddddddd5bbbbbbb5ddddddd5bbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbb5ddddd5bbbbbbbb5ddddddd5bbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbb5d5b5d5bbbbbbb5ddd5b5ddd5bbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbb5d5b5d5bbbbbb5ddd5bbb5ddd5bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbb5d5b5d5bbbbbbddd5bbbbb5dddbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbb5d5b5d5bbbbbbdd5bbbbbbb5ddbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbbbdbbbdbbbbbbbbbbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbbbbbbb555bbbbb445bbbbb555bbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbbb44444445bbbb4445b4444445bbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbbb444444444bbb5444544444444bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000b55554444888445bbb5444444888445b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000444444448888844bbbb544448888844b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000b555544888888845bbbb5448888888450000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbbb44888877845bbbbb448888778450000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000b555544888877845bbbb5448888778450000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000444444448888844bbbb544448888844b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000b55554444888445bbb5444444888445b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbbb444444444bbb5444544444444bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbbb44444445bbbb4445b4444445bbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbbbbbbb555bbbbb445bbbbb555bbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

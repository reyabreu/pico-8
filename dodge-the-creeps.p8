pico-8 cartridge // http://www.pico-8.com
version 23
__lua__
function flr2(v)
	local nv=v*100
	if (abs(nv-flr(nv))>=0.5)	nv+=1
	return flr(nv)/100
end

function rndb(lo,hi)
	return flr(rnd(hi-lo+1)+lo)
end

function _init()
	creeps={}
	path={
		{10 , 10},
		{120, 10},		
		{120,120},
		{10, 120},
	}
	local st=path[1]
	spd=2
	x,y=st[1],st[2]
	np=2
	nangle=0
end

function _update()
	if (np>#path) np=1
	local p1={x,y}		
	local p2=path[np]
	
	local a=p2[1]-p1[1]
	local b=p2[2]-p1[2]
	
	angle=atan2(a,b)
	nangle=angle-0.25
	
	x=flr2(cos(angle)*spd+p1[1])
	y=flr2(sin(angle)*spd+p1[2])
	
	if abs(x-p2[1])<spd and 
		abs(y-p2[2])<spd then
		np+=1
	end
		
	for c in all(creeps) do
		c.x=c.x+c.dx
		c.y=c.y+c.dy
		if c.x<0 or c.x>127 or
			c.y<0 or c.y>127 then
			del(creeps,c)
		end
	end	
	
	if rndb(1,10)>9 then
		dx=rnd(2.5)*cos(nangle)
		dy=rnd(2.5)*sin(nangle)
		
		if (dx==0) dx=-rnd(2)+1
		if (dy==0) dy=-rnd(2)+1
	
		creep={x=x,y=y,dx=dx,dy=dy,i=17+rndb(0,2)*17}
		add(creeps,creep)
	end
end

function _draw()
	cls()
	local p1,p2
	for i=2,#path do
		p1,p2=path[i-1],path[i]
		line(p1[1],p1[2],p2[1],p2[2],7)		
	end
	p1,p2=path[#path],path[1]
	line(p1[1],p1[2],p2[1],p2[2],7)
	
	for c in all(creeps) do
		--pset(c.x,c.y,8)
		--circ(c.x,c.y,2,8)
		spr(c.i,c.x,c.y)
	end
	
	color(7)
	print(x..","..y,60,60)
	print("nangle:"..nangle,60,68)	
	
	pset(x,y,rnd({11,12}))
	line(x,y,x+4*cos(nangle),y+4*sin(nangle),10)
end
__gfx__
00000000005550000055500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000056665000566650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700567776505677765000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770005677d6505677d65000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000567776505677765000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700056665000566650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000005550000055500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000005050000500050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000040444000004440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000004868404448684000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000004888400048884000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000004484904444849000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000040499000004990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000444004004440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000440868440408684400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000004888940048889400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000440484900404849000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000499004004990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000044000000440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000004044404440444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000486840004868400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000488894444888900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000004094900440949000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000044000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

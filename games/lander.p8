pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
-- moon lander
-- by reynaldo
function _init()
	game_over=false
	win=false
	end_burst=false
	g=0.025 --gravity
	make_ground()
	make_player()
end

function _update()
	if not game_over then
		move_player()
		check_landing()
	elseif not win then
		if #burst==0 and not end_burst then
			make_explosions(p.x+3,p.y+3,10)
		end
	end
	if game_over then
		if not cor then
			cor=cocreate(oscillate)			
		elseif cor and costatus(cor) != 'dead' then
			coresume(cor)			
		end
	end	
end

function _draw()
	cls()
	draw_stars()
	draw_ground()
	if game_over then
		draw_banner()
	else
		draw_player()
	end
end
-->8
--player
function make_player()
	p={}
	p.x=60
	p.y=8
	p.dx=0
	p.dy=0
	p.sprite=1
	p.alive=true
	p.thrust=0.075
end

function draw_player()
	if game_over then
		if win then
			spr(p.sprite,p.x,p.y)
			spr(4,p.x,p.y-8) -- raise flag
		else
			--spr(5,p.x,p.y)
			if (not end_burst) draw_explosions()
		end
	else
		spr(p.sprite,p.x,p.y)
	end
end

function move_player()
	p.dy+=g --add gravity
	
	thrust()
	
	p.x+=p.dx
	p.y+=p.dy
	
	stay_on_screen()
end

function thrust()
	if (btn(⬅️)) p.dx-=p.thrust
	if (btn(➡️)) p.dx+=p.thrust
	if (btn(⬆️)) p.dy-=p.thrust
	
	if (btn(⬅️) or btn(➡️) or btn(⬆️)) sfx(0)
end

function stay_on_screen()
	if p.x<0 then
		p.x=0
	elseif p.x>119 then
		p.x=119 p.dx=0
	end
	if p.y<0 then
		p.y=0 p.dy=0
	end
end
-->8
--utils
function rnob(low,high)
	return flr(rnd(high-low+1)+low)
end

function draw_stars()
	srand(1)
	for i=1,50 do
		pset(rnob(0,127),rnob(0,118),rnob(5,7))
	end
	srand(time())
end

function make_ground()
	gnd={}
	local top=96
	local btm=120
	
	--landing pad
	pad={}
	pad.width=15
	pad.x=rnob(0,126-pad.width)
	pad.y=rnob(top,btm)
	pad.sprite=2
	
	--ground at pad
	for i=pad.x,pad.x+pad.width do
		gnd[i]=pad.y
	end
	
	--ground right of pad
	for i=pad.x-1,0,-1 do
		local h=rnob(gnd[i+1]-3,gnd[i+1]+3)
		gnd[i]=mid(top,h,btm)
	end
	
	--ground left of pad
	for i=pad.x+pad.width+1,127 do
		local h=rnob(gnd[i-1]-3,gnd[i-1]+3)
		gnd[i]=mid(top,h,btm)
	end
end

function draw_ground()
	for i=0,127 do
		line(i,gnd[i],i,127,5)
	end
	spr(pad.sprite,pad.x,pad.y,2,1)
end

burst={}
function make_explosions(x,y,n)
	for i=1,n do
		local explosion = {}
		explosion.x=x+(rnd(2)-1)*10
		explosion.y=y+(rnd(2)-1)*10
		explosion.r=4
		explosion.c=10
		add(burst, explosion)
	end
end

function draw_explosions()
	for e in all(burst) do
		circfill(e.x,e.y,e.r,e.c)
		e.r-=1
		if (e.r<4) e.c=9
		if (e.r<2) e.c=8
		if (e.r<=0) del(burst, e)
		if (#burst==0) end_burst=true
	end
end

-->8
--game ctl
function check_landing()
	l_x=flr(p.x)   --left side of ship
	r_x=flr(p.x+7) --right side of ship
	b_y=flr(p.y+7) --bottom of ship
	
	over_pad=l_x>=pad.x and r_x<=pad.x+pad.width
	on_pad=b_y>=pad.y-1
	slow=p.dy<1
	
	if (over_pad and on_pad and slow) then
		end_game(true)
	elseif (over_pad and on_pad) then
		end_game(false)
	else
		for i=l_x,r_x do
			if (gnd[i]<=b_y) then
				end_game(false) 
			end
		end
	end
end

function end_game(won)
	game_over=true
	win=won
	
	if win then
		sfx(1)
	else
		sfx(2)
	end
end
-->8
-- co routines
cor=nil
banner={}

function draw_banner()
	print("Game Over",banner.x,banner.y,7)
end

function oscillate()
	banner.x=30
	for i=1,10 do
		banner.y=60+60*SIN(i/10)
		yield()
	end
end
__gfx__
00000000006666007602222222222766000000000088880000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000066c76607666666666666666000000000899998000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070066ccc766007666666666660000000000899aa99800000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700066cccc660000000000000000000b600089aaaa9800000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700066555566000000000000000000bb600089aaaa9800000000000000000000000000000000000000000000000000000000000000000000000000000000
007007000666666000000000000000000bbb6000899aa99800000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000050550500000000000000000000060000899998000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000660660660000000000000000000060000088880000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000070000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000070000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005000000000700000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000050000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000700000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000666600000000000000000000000000000000000000000000000000000000000000
000000000007000000000000000000000000000000000000000000000000066c7660000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000007000000000000000000066ccc766000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000066cccc66000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000066555566000000000000000000000000000000000000000000000000000500060000
00000000000000000000000000000000000000000000000000000000000006666660000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000005055050000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000066066066000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000050000000000000000
00000000000000000000000000000700000000000000000000000000000000000000000000000000000000000000000000000050000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000050000000000000000000000000000000000000000000000000000000000000000000000000000000000070000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000060000000000000050000000000000000000000000000000000000050000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000060000000000000000000000000000000005000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000005000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000077000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000005050555550500000000000000055555555555555000000000000000000000000000000000000000500500000000000000000000000000000000000000
00000005555555555500050000055000555555555555555505000000000000000000000000000050000005550500000000000000000000000000000000000000
00000005555555555550050000055000555555555555555555000000000000000000000000000050000555550500000000000000000000000000000000000000
00000055555555555550555000555000555555555555555555050000000000000000000000000050500555555550500000000000000000000000000000000000
00050555555555555555555550555555555555555555555555550000050000000000000000000555505555555550550000000000000000500000000000000000
05550555555555555555555555555555555555555555555555550005550000000000000000000555505555555555550000000000000000500000000000000000
05550555555555555555555555555555555555555555555555555005555000000000000000000555555555555555557652222222222766500500000000000000
05555555555555555555555555555555555555555555555555555505555000000000000000005555555555555555557666666666666666550505000000000000
55555555555555555555555555555555555555555555555555555555555000000000000000005555555555555555555576666666666655555555000000000000
55555555555555555555555555555555555555555555555555555555555550000005000000055555555555555555555555555555555555555555000500000055
55555555555555555555555555555555555555555555555555555555555550000005000000055555555555555555555555555555555555555555500500000055
55555555555555555555555555555555555555555555555555555555555550000055000005555555555555555555555555555555555555555555505550050055
55555555555555555555555555555555555555555555555555555555555555000055500055555555555555555555555555555555555555555555505550050555
55555555555555555555555555555555555555555555555555555555555555550555500555555555555555555555555555555555555555555555555550055555
55555555555555555555555555555555555555555555555555555555555555550555505555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555

__sfx__
000600000e63000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000c00001f0701f0301d0701c03018070180302407024030000001707020070200300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000400003d630376203161029620226201d62017620126100c6100861004610026100161001610016100161001600026000360007600056000360002600026000160000600000000000000000000000000000000

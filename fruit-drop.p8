pico-8 cartridge // http://www.pico-8.com
version 35
__lua__
-- fruit drop
-- by @reyabreu
basket_sprite=1
player_sprite=2

player_x=64
player_y=100
player_speed=0
player_frame=0

fruits={}
fruit_start=16
fruit_count=6
fruit_interval=16

gravity=1
level=1
points=0

function _init()
	for i=1,level do
		fruit={
			sprite=flr(rnd(fruit_count)+fruit_start),
			x=flr(rnd(120)+5),
			y=i*(-fruit_interval)
		}
		add(fruits,fruit)
	end
end

function _update()	
	for fruit in all(fruits) do
		fruit.y+=gravity
		
		if fruit.y+4>=player_y-8
		and fruit.y+4<=player_y
		and fruit.x+4>=player_x
		and fruit.x+4<=player_x+8 then
  	points+=1
  	del(fruits,fruit)
  	sfx(0)
		end
		
		if fruit.y>100 then
			del(fruits,fruit)
			sfx(1)
		end
	end
	
	if #fruits==0 then
		level+=1
		_init()
	end
	
	local dx=0
	if btn(0) then dx=-3 end
	if btn(1) then dx= 3 end
	player_speed=lerp(player_speed,dx,0.08)
	if (abs(player_speed)<0.1 and dx==0) player_speed=0
	player_x=mid(0,player_x+player_speed,121)
	
	if dx!=0 then
		player_frame=(player_frame+1)%3 -- 3 frames
		player_sprite=player_frame+2
	end
end

function lerp(start,finish,factor)
	return mid(start,start*(1-factor)+finish*factor,finish)
end

function _draw()
	cls()
	--rectfill(0,108,127,127,3)
	map()
	spr(player_sprite,player_x,player_y)
	spr(basket_sprite,player_x,player_y-8)
	
	for fruit in all(fruits) do
		spr(fruit.sprite,fruit.x,fruit.y)
	end
	
	print("score="..points)
end

__gfx__
0000000006666660f044440ff044440ff044440f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000070000006f0ffff0ff0ffff0ff0ffff0f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070067777775f0ffff0f88ffff8880ffff080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700066060605888ff888008ff800888ff8880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000606060550088880000888800008888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007006606050500cccc0000cccc0000cccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000605050550c0000c000c00c000c0000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000005555550dd0000dd0dd00dd000d00d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000043b00000090000b0b0b00000b300000000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000bb03b00000a40000bbb00000b3300000008730099b30000000000000000000000000000000000000000000000000000000000000000000000000000000000
00b7bb0000000a4000f9a900088338800000807b099b388000000000000000000000000000000000000000000000000000000000000000000000000000000000
00b7bb000000a9400f9a9a4088e888880008887b9779998800000000000000000000000000000000000000000000000000000000000000000000000000000000
0b7bbb30000a940009a9a4908e7e88820080807b9799998800000000000000000000000000000000000000000000000000000000000000000000000000000000
0bbbbb300aa940000a9a494088e88882088887b39999998800000000000000000000000000000000000000000000000000000000000000000000000000000000
03bbbb300994000009a4949008888820b7777b300999988000000000000000000000000000000000000000000000000000000000000000000000000000000000
0033330000000000004949000022220003bbb3000088880000000000000000000000000000000000000000000000000000000000000000000000000000000000
3333333333333333cc5445ccb3ccccb3cccccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4343433344343434cc4554cc393cc33bcccccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3444443444444444cc5445ccc39c3b93cccccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444444444444444cc4554ccc3393933cccccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444444444444444cc5445cc3933933ccccccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444444444444444cc4554cc3b93b3cccccccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444444444444444cc5445ccc339b3cccccccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444444444444444cc4554cccc393bcccccccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
2424242424242424242424242424242400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2424242424242424242424242424232400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2424232424242424242424242424222400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2424222424242424242423242424222400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2424222424242324242422242424222400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2324222324242224242422242423222300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2020212021202020212020202021202100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
00020000000002b320217301974024470000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0002000000000190500f530146501f670000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
